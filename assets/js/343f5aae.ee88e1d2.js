"use strict";(self.webpackChunksailpoint_developer_portal=self.webpackChunksailpoint_developer_portal||[]).push([["303810"],{328034(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var i=n(895676),o=n(474848),r=n(28453);let s={id:"sap-provisioning-modify-rule",title:"SAP HR Provisioning Modify Rule",pagination_label:"SAP HR Provisioning Modify Rule",sidebar_label:"SAP HR Provisioning Modify Rule",sidebar_class_name:"sapHRProvisioningModifyRule",keywords:["cloud","rules","sap"],description:"This rule performs SAP HR modification operations during provisioning. This rule is typically used for attribute sync to custom SAP HR attributes.",slug:"/extensibility/rules/connector-rules/sap-provisioning-modify-rule",tags:["Rules"]},a,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Execution",id:"execution",level:2},{value:"Input",id:"input",level:2},{value:"Output",id:"output",level:2},{value:"Template",id:"template",level:2},{value:"Example",id:"example",level:2},{value:"Attach to source",id:"attach-to-source",level:2}];function u(e){let t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(t.p,{children:"This rule performs SAP HR modification operations during provisioning. This rule is typically used for attribute sync to custom SAP HR attributes."}),"\n",(0,o.jsx)(t.h2,{id:"execution",children:"Execution"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Connector Execution"})," - This rule executes within the virtual appliance. It may offer special abilities to perform connector-related functions, and it may offer managed connections to sources."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Logging"})," - Logging statements are viewable within the ccg.log on the virtual appliance, and they are viewable by SailPoint personnel."]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Rule Execution",src:n(404758).A+"",width:"1525",height:"618"})}),"\n",(0,o.jsx)(t.h2,{id:"input",children:"Input"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Argument"}),(0,o.jsx)(t.th,{children:"Type"}),(0,o.jsx)(t.th,{children:"Purpose"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"application"}),(0,o.jsx)(t.td,{children:"sailpoint.object.Application"}),(0,o.jsx)(t.td,{children:"Reference to the application object."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"schema"}),(0,o.jsx)(t.td,{children:"sailpoint.object.Schema"}),(0,o.jsx)(t.td,{children:"Reference to the application schema."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"destination"}),(0,o.jsx)(t.td,{children:"com.sap.conn.jco.JCoDestination"}),(0,o.jsx)(t.td,{children:"Connected and ready-to-use SAP destination object that can be used to call BAPI function modules and call to SAP tables."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"plan"}),(0,o.jsx)(t.td,{children:"sailpoint.object.ProvisioningPlan"}),(0,o.jsx)(t.td,{children:"Provisioning plan containing the provisioning request(s)."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"request"}),(0,o.jsx)(t.td,{children:"sailpoint.object.ProvisioningPlan.AbstractRequest"}),(0,o.jsx)(t.td,{children:"AccountRequest being processed. It is always null for this global rule. It is only set for SapHrOperationProvisioning."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"connector"}),(0,o.jsx)(t.td,{children:"sailpoint.connector.SAPHRConnector"}),(0,o.jsx)(t.td,{children:"Application connector being used for the operation."})]})]})]}),"\n",(0,o.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Argument"}),(0,o.jsx)(t.th,{children:"Type"}),(0,o.jsx)(t.th,{children:"Purpose"})]})}),(0,o.jsx)(t.tbody,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"result"}),(0,o.jsx)(t.td,{children:"sailpoint.object.ProvisioningResult"}),(0,o.jsx)(t.td,{children:"ProvisioningResult object containing the provisioning request's status (success, failure, retry, etc.)."})]})})]}),"\n",(0,o.jsx)(t.h2,{id:"template",children:"Template"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">\n<Rule name="Example Rule" type="SapHrOperationProvisioning">\n  <Description>Describe your rule here.</Description>\n  <Source><![CDATA[\n\n  // Add your logic here.\n\n  ]]></Source>\n</Rule>\n'})}),"\n",(0,o.jsx)(t.h2,{id:"example",children:"Example"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n\n<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">\n\n<Rule name="Example Rule" type="SapHrOperationProvisioning">\n\n  <Description>\n\nThis rule is used by the SAP HR connector for provisioning of the data.\n\n</Description>\n\n  <Source><![CDATA[\n  import sailpoint.object.*;\n  import sailpoint.object.ProvisioningPlan.AccountRequest;\n  import sailpoint.object.ProvisioningPlan.AttributeRequest;\n  import sailpoint.object.ProvisioningPlan.ObjectOperation;\n  import sailpoint.object.ProvisioningPlan.AccountRequest.Operation;\n  import sailpoint.tools.Util;\n  import java.text.SimpleDateFormat;\n  import java.util.Date;\n  import java.util.Map;\n  import java.util.HashMap;\n  import com.sap.conn.jco.AbapException;\n  import com.sap.conn.jco.JCoDestination;\n  import com.sap.conn.jco.JCoException;\n  import sailpoint.connector.ConnectorException;\n  import com.sap.conn.jco.JCoFunction;\n  import com.sap.conn.jco.JCoParameterField;\n  import com.sap.conn.jco.JCoParameterFieldIterator;\n  import com.sap.conn.jco.JCoParameterList;\n  import com.sap.conn.jco.JCoStructure;\n  import com.sap.conn.jco.JCoTable;\n  import com.sap.conn.jco.JCoContext;\n\n  // subtype values for email , Telephone or system user name\n  String SUBTYPE_EMAIL = "0010"; //Sub info type for email address\n  String SUBTYPE_PHONE= "0020"; //Sub info type for telephone number\n  String SUBTYPE_SY_USERNAME= "0001";  //Sub info type for sy-username which can be mapped to SAMAccountName of AD\n\n  ProvisioningResult result = new ProvisioningResult();\n\n  //This function will modify the email address , Telephone or system user name if recieved in the plan\n  public void doProvision() throws Exception {\n    List<AccountRequest> accReqList = plan.getAccountRequests();\n    String accNativeIdentity = null;\n    String endDateStr = "", beginDateStr = "";\n    SimpleDateFormat formatter = new SimpleDateFormat("yyyyMMdd");\n\n    if (!Util.isEmpty(accReqList)) {\n      for( AccountRequest accountReq : accReqList ) {\n        result.setStatus( ProvisioningResult.STATUS_COMMITTED );\n        accNativeIdentity = accountReq.getNativeIdentity();\n\n        // For update operation only Email,Telephone,SY-UNAME atrribute are supported\n        AttributeRequest emailAttr = accountReq.getAttributeRequest("Email");\n        AttributeRequest phoneAttrib = accountReq.getAttributeRequest("Telephone");\n        AttributeRequest syUserAttrib = accountReq.getAttributeRequest("System user name (SY-UNAME)");\n        HashMap beginEndDateList = getCommunicationData( accNativeIdentity );\n\n        //Finding the email attribute in provisioning plan and trying to modify the account\'s email id\n        if ( null != emailAttr ) {\n          if(null !=beginEndDateList && beginEndDateList.containsKey("emailBegin")) {\n            beginDateStr = formatter.format(beginEndDateList.get("emailBegin"));\n            endDateStr = formatter.format(beginEndDateList.get("emailEnd"));\n          }\n          modifyCommunicationData(accNativeIdentity, emailAttr.getValue(), SUBTYPE_EMAIL,beginDateStr,endDateStr);\n        }\n\n        //Finding the Telephone attribute in provisioning plan and trying to modify the account\'s phone\n        if ( null != phoneAttrib ) {\n          if(null !=beginEndDateList && beginEndDateList.containsKey("phoneBegin")) {\n            beginDateStr = formatter.format(beginEndDateList.get("phoneBegin"));\n            endDateStr = formatter.format(beginEndDateList.get("phoneEnd"));\n          }\n          modifyCommunicationData(accNativeIdentity, phoneAttrib.getValue(), SUBTYPE_PHONE,beginDateStr,endDateStr);\n        }\n\n        //Finding the system user name attribute in provisioning plan and trying to modify the account\'s System User Name\n        if ( null != syUserAttrib) {\n          if(null !=beginEndDateList && beginEndDateList.containsKey("syUserBegin")) {\n            beginDateStr = formatter.format(beginEndDateList.get("syUserBegin"));\n            endDateStr = formatter.format(beginEndDateList.get("syUserEnd"));\n          }\n          modifyCommunicationData(accNativeIdentity,syUserAttrib.getValue(), SUBTYPE_SY_USERNAME,beginDateStr,endDateStr);\n        }\n      }\n    }\n  }\n\n  // This function will get the communication details about a given employee\n  // In this example the email, Telephone and system user name begin and end date will be retrieved\n  public HashMap getCommunicationData( String id ) throws Exception {\n    HashMap commAttrsList = new HashMap();\n    JCoFunction getCommDetail = connector.getFunction(destination, "BAPI_EMPLCOMM_GETDETAILEDLIST");\n    getCommDetail.getImportParameterList().setValue("EMPLOYEENUMBER", id);\n    getCommDetail.getImportParameterList().setValue("TIMEINTERVALLOW", new Date());\n    getCommDetail.getImportParameterList().setValue("TIMEINTERVALHIGH", new Date());\n\n    try {\n      getCommDetail.execute(destination);\n    } catch (Exception e) {\n      connector.checkForExceptions(getCommDetail);\n      throw new Exception(e);\n    }\n\n    JCoTable commTable = getCommDetail.getTableParameterList().getTable("COMMUNICATION");\n    if ( commTable != null ) {\n      int rows = commTable.getNumRows();\n      for (int i = 0; i < rows; i++) {\n        commTable.setRow(i);\n        String commType = commTable.getString("SUBTYPE");\n        commAttrsList = getDateData(commTable, commAttrsList, commType);\n      }\n    }\n    return commAttrsList;\n  }\n\n\n  // function captures the begin date and end date\n  public HashMap getDateData(JCoTable commTable, HashMap commAttrsList, String commType) {\n    Date validBegDate = commTable.getDate("VALIDBEGIN");\n    Date validEndDate = commTable.getDate("VALIDEND");\n    if ( validBegDate != null && validEndDate != null ) {\n      if (commType.equals(SUBTYPE_EMAIL)) {\n        commAttrsList.put("emailBegin", validBegDate);\n        commAttrsList.put("emailEnd", validEndDate);\n      } else if (commType.equals(SUBTYPE_PHONE)) {\n        commAttrsList.put("phoneBegin", validBegDate);\n        commAttrsList.put("phoneEnd", validEndDate);\n      }else if (commType.equals(SUBTYPE_SY_USERNAME)) {\n        commAttrsList.put("syUserBegin", validBegDate);\n        commAttrsList.put("syUserEnd", validEndDate);\n      }\n    }\n    return commAttrsList;\n  }\n\n\n  /**Function modifies the email address , Telephone number and System user name of SAP HR record.\n  If Email or Phone is present(assigned) then used BAPI_EMPLCOMM_CHANGE\n  If Email or Phone is not present(assigned) then used BAPI_EMPLCOMM_CREATE\n  * @param userId\n  * @param parValue\n  * @param type\n  * @param begDate\n  * @param endDate\n  * @throws ConnectorException\n  */\n\n  private void modifyCommunicationData( String userId, String parValue, String type,String begDate,String endDate ) throws ConnectorException {\n    JCoFunction jcoFunctionObject;\n    if (begDate.length() > 1 ) { //If date is alreday present then use BAPI_EMPLCOMM_CHANGE to modify data\n      jcoFunctionObject = connector.getFunction(destination,"BAPI_EMPLCOMM_CHANGE");\n    } else { //If date is not present then use BAPI_EMPLCOMM_CREATE to add data\n      jcoFunctionObject = connector.getFunction(destination,"BAPI_EMPLCOMM_CREATE");\n    }\n\n    // BAPI locks the record for processing\n    JCoFunction functionEnqueue = destination.getRepository().getFunction("BAPI_EMPLOYEE_ENQUEUE");\n    functionEnqueue.getImportParameterList().setValue("NUMBER", userId);\n    if ( functionEnqueue == null )\n      throw new RuntimeException("BAPI_EMPLOYEE_ENQUEUE not found in SAP.");\n\n    // BAPI to modify Communication data - email and phone\n    if ( jcoFunctionObject == null )\n      throw new RuntimeException("BAPI_EMPLCOMM_CHANGE not found in SAP.");\n\n    String returnPersonnelID = null;\n    jcoFunctionObject.getImportParameterList().setValue("EMPLOYEENUMBER", userId); // Personal Number\n    jcoFunctionObject.getImportParameterList().setValue("SUBTYPE", type); // SubType 0010/0020 - Email/Phone\n    jcoFunctionObject.getImportParameterList().setValue("VALIDITYBEGIN", begDate); // Begin Date\n    jcoFunctionObject.getImportParameterList().setValue("VALIDITYEND", endDate); // End Date\n    jcoFunctionObject.getImportParameterList().setValue("COMMUNICATIONID", parValue); // Email Address to modify\n\n    // BAPI unlocks the record after processing\n    JCoFunction functionDequeue = destination.getRepository().getFunction("BAPI_EMPLOYEE_DEQUEUE");\n    functionDequeue.getImportParameterList().setValue("NUMBER", userId);\n    if ( functionDequeue == null )\n      throw new RuntimeException("BAPI_EMPLOYEE_DEQUEUE not found in SAP.");\n\n    try {\n      // executing Bapis\n      JCoContext.begin(destination);\n      functionEnqueue.execute(destination);\n      jcoFunctionObject.execute(destination);\n      functionDequeue.execute(destination);\n    } catch (ConnectorException e) {\n      throw e;\n    } finally {\n      JCoContext.end(destination);\n    }\n  }\n\n  doProvision();\n  return result;\n\n    ]]></Source>\n\n</Rule>\n'})}),"\n",(0,o.jsx)(t.h2,{id:"attach-to-source",children:"Attach to source"}),"\n",(0,o.jsxs)(t.p,{children:["Refer to ",(0,o.jsx)(t.a,{href:"/docs/extensibility/rules/connector-rules#sap-hr-provisioning-modify-rule",children:"Attaching Connector-Related Rules to Sources"})," for details on how to attach your rule to your source."]})]})}function d(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},404758(e,t,n){n.d(t,{A:()=>i});let i=n.p+"assets/images/connector_execution-a516e4420c18c0906bef94a9b1299330.png"},28453(e,t,n){n.d(t,{R:()=>s,x:()=>a});var i=n(296540);let o={},r=i.createContext(o);function s(e){let t=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:t},e.children)}},895676(e){e.exports=JSON.parse('{"id":"extensibility/rules/connector-rules/sap-provisioning-modify-rule","title":"SAP HR Provisioning Modify Rule","description":"This rule performs SAP HR modification operations during provisioning. This rule is typically used for attribute sync to custom SAP HR attributes.","source":"@site/docs/extensibility/rules/connector-rules/sap_hr_provisioning_modify_rule.md","sourceDirName":"extensibility/rules/connector-rules","slug":"/extensibility/rules/connector-rules/sap-provisioning-modify-rule","permalink":"/docs/extensibility/rules/connector-rules/sap-provisioning-modify-rule","draft":false,"unlisted":false,"editUrl":"https://github.com/sailpoint-oss/developer.sailpoint.com/edit/main/docs/extensibility/rules/connector-rules/sap_hr_provisioning_modify_rule.md","tags":[{"inline":true,"label":"Rules","permalink":"/docs/tags/rules"}],"version":"current","lastUpdatedBy":"darrell-thobe-sp","lastUpdatedAt":1746721553000,"frontMatter":{"id":"sap-provisioning-modify-rule","title":"SAP HR Provisioning Modify Rule","pagination_label":"SAP HR Provisioning Modify Rule","sidebar_label":"SAP HR Provisioning Modify Rule","sidebar_class_name":"sapHRProvisioningModifyRule","keywords":["cloud","rules","sap"],"description":"This rule performs SAP HR modification operations during provisioning. This rule is typically used for attribute sync to custom SAP HR attributes.","slug":"/extensibility/rules/connector-rules/sap-provisioning-modify-rule","tags":["Rules"]},"sidebar":"openApiSidebar","previous":{"title":"SAP BuildMap Rule","permalink":"/docs/extensibility/rules/connector-rules/sap-buildmap-rule"},"next":{"title":"Web Services After Operation Rule","permalink":"/docs/extensibility/rules/connector-rules/webservices-after-provisioning-rule"}}')}}]);